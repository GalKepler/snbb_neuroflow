# Neuroflow Configuration Example
# Copy to neuroflow.yaml and customize

paths:
  dicom_incoming: /mnt/62/Raw_Data
  bids_root: /data/brainbank/bids
  derivatives: /data/brainbank/derivatives
  work_dir: /data/brainbank/.neuroflow
  log_dir: /var/log/neuroflow

database:
  url: "sqlite:////data/brainbank/.neuroflow/neuroflow.db"

redis:
  url: "redis://localhost:6379/0"

dataset:
  name: "brainbank"
  session_ids: ["baseline", "followup"]
  dicom_participant_first: true

protocol:
  stability_wait_minutes: 180
  bids_conversion_min_files: 10

pipelines:
  bids_conversion:
    enabled: true
    tool: "heudiconv"
    version: "1.3.4"
    timeout_minutes: 60
    retries: 2
    voxelops_config:
      heuristic: "/etc/neuroflow/heuristics/brainbank.py"
      bids_validator: true
      overwrite: false
      converter: "dcm2niix"
      docker_image: "nipy/heudiconv:1.3.4"
      post_process: true

  session_level:
    - name: "mriqc"
      enabled: true
      runner: "voxelops.runners.mriqc"
      container: "nipreps/mriqc:24.0.0"
      timeout_minutes: 120
      requirements:
        bids_suffixes: ["T1w"]

    - name: "freesurfer"
      enabled: true
      runner: "voxelops.runners.freesurfer"
      container: "freesurfer/freesurfer:7.4.1"
      timeout_minutes: 720
      requirements:
        bids_suffixes: ["T1w"]

    - name: "qsiprep"
      enabled: false  # Enable if you have diffusion data
      runner: "voxelops.runners.qsiprep.run_qsiprep"
      timeout_minutes: 720
      voxelops_config:
        nprocs: 8
        mem_mb: 16000
        output_resolution: 1.6
        anatomical_template: ["MNI152NLin2009cAsym"]
        fs_license: "/opt/freesurfer/license.txt"
        docker_image: "pennlinc/qsiprep:latest"
        force: false
      requirements:
        bids_suffixes: ["dwi"]

  subject_level:
    - name: "qsirecon"
      enabled: false  # Enable if you have QSIPrep outputs
      runner: "voxelops.runners.qsirecon.run_qsirecon"
      timeout_minutes: 480
      voxelops_config:
        nprocs: 8
        mem_mb: 16000
        recon_spec: "/etc/neuroflow/specs/dsi_studio.yaml"
        atlases: ["Brainnetome246Ext", "AAL116"]
        fs_license: "/opt/freesurfer/license.txt"
        docker_image: "pennlinc/qsirecon:latest"
        force: false

    - name: "qsiparc"
      enabled: false  # Enable if you have QSIRecon outputs
      runner: "voxelops.runners.qsiparc.run_qsiparc"
      timeout_minutes: 120
      voxelops_config:
        mask: "gm"
        force: false
        n_jobs: 1
        n_procs: 1

celery:
  worker_concurrency: 2
  task_soft_time_limit: 43200
  task_time_limit: 86400

logging:
  level: INFO
  format: console
